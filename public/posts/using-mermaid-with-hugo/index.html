<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Using Mermaid With Hugo | Clem SK</title>
<meta name=keywords content="diagrams,mermaid"><meta name=description content="Main steps

Create a layout
Adding Mermaid to a content template
Maintaining content and theme styles
Rendering an example diagram

Mermaid diagram
This post outlines how to add Mermaid support with Hugo to render the diagram below, as I found the docs a bit lacking.

When pasting, make sure to move the closing code fence to a new line to see the diagram

```mermaid
sequenceDiagram
    participant Alice
    participant Bob
    Alice->>John: Hello John, how are you?
    loop Healthcheck
        John->>John: Fight against hypochondria
    end
    Note right of John: Rational thoughts <br/>prevail!
    John-->>Alice: Great!
    John->>Bob: How about you?
    Bob-->>John: Jolly good!```
Creating a layout
While Mermaid markdown diagrams aren&rsquo;t supported natively by Hugo, it&rsquo;s easy to add."><meta name=author content="Clement Seconde-Kynnersley"><link rel=canonical href=https://clem-sk.dev/posts/using-mermaid-with-hugo/><link crossorigin=anonymous href=/assets/css/stylesheet.986fe03b6849f98be5000b7e092db54278d597af9b7d3aba06d460674d698475.css integrity="sha256-mG/gO2hJ+YvlAAt+CS21QnjVl6+bfTq6BtRgZ01phHU=" rel="preload stylesheet" as=style><link rel=icon href=https://clem-sk.dev/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://clem-sk.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://clem-sk.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://clem-sk.dev/apple-touch-icon.png><link rel=mask-icon href=https://clem-sk.dev/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://clem-sk.dev/posts/using-mermaid-with-hugo/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Using Mermaid With Hugo"><meta property="og:description" content="Main steps

Create a layout
Adding Mermaid to a content template
Maintaining content and theme styles
Rendering an example diagram

Mermaid diagram
This post outlines how to add Mermaid support with Hugo to render the diagram below, as I found the docs a bit lacking.

When pasting, make sure to move the closing code fence to a new line to see the diagram

```mermaid
sequenceDiagram
    participant Alice
    participant Bob
    Alice->>John: Hello John, how are you?
    loop Healthcheck
        John->>John: Fight against hypochondria
    end
    Note right of John: Rational thoughts <br/>prevail!
    John-->>Alice: Great!
    John->>Bob: How about you?
    Bob-->>John: Jolly good!```
Creating a layout
While Mermaid markdown diagrams aren&rsquo;t supported natively by Hugo, it&rsquo;s easy to add."><meta property="og:type" content="article"><meta property="og:url" content="https://clem-sk.dev/posts/using-mermaid-with-hugo/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-06T08:35:09+00:00"><meta property="article:modified_time" content="2024-02-06T08:35:09+00:00"><meta property="og:site_name" content="ClemSK"><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Mermaid With Hugo"><meta name=twitter:description content="Main steps

Create a layout
Adding Mermaid to a content template
Maintaining content and theme styles
Rendering an example diagram

Mermaid diagram
This post outlines how to add Mermaid support with Hugo to render the diagram below, as I found the docs a bit lacking.

When pasting, make sure to move the closing code fence to a new line to see the diagram

```mermaid
sequenceDiagram
    participant Alice
    participant Bob
    Alice->>John: Hello John, how are you?
    loop Healthcheck
        John->>John: Fight against hypochondria
    end
    Note right of John: Rational thoughts <br/>prevail!
    John-->>Alice: Great!
    John->>Bob: How about you?
    Bob-->>John: Jolly good!```
Creating a layout
While Mermaid markdown diagrams aren&rsquo;t supported natively by Hugo, it&rsquo;s easy to add."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://clem-sk.dev/posts/"},{"@type":"ListItem","position":2,"name":"Using Mermaid With Hugo","item":"https://clem-sk.dev/posts/using-mermaid-with-hugo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Mermaid With Hugo","name":"Using Mermaid With Hugo","description":"Main steps Create a layout Adding Mermaid to a content template Maintaining content and theme styles Rendering an example diagram Mermaid diagram This post outlines how to add Mermaid support with Hugo to render the diagram below, as I found the docs a bit lacking.\nWhen pasting, make sure to move the closing code fence to a new line to see the diagram\n```mermaid sequenceDiagram participant Alice participant Bob Alice-\u0026gt;\u0026gt;John: Hello John, how are you? loop Healthcheck John-\u0026gt;\u0026gt;John: Fight against hypochondria end Note right of John: Rational thoughts \u0026lt;br/\u0026gt;prevail! John--\u0026gt;\u0026gt;Alice: Great! John-\u0026gt;\u0026gt;Bob: How about you? Bob--\u0026gt;\u0026gt;John: Jolly good!``` Creating a layout While Mermaid markdown diagrams aren\u0026rsquo;t supported natively by Hugo, it\u0026rsquo;s easy to add.\n","keywords":["diagrams","mermaid"],"articleBody":"Main steps Create a layout Adding Mermaid to a content template Maintaining content and theme styles Rendering an example diagram Mermaid diagram This post outlines how to add Mermaid support with Hugo to render the diagram below, as I found the docs a bit lacking.\nWhen pasting, make sure to move the closing code fence to a new line to see the diagram\n```mermaid sequenceDiagram participant Alice participant Bob Alice-\u003e\u003eJohn: Hello John, how are you? loop Healthcheck John-\u003e\u003eJohn: Fight against hypochondria end Note right of John: Rational thoughts prevail! John--\u003e\u003eAlice: Great! John-\u003e\u003eBob: How about you? Bob--\u003e\u003eJohn: Jolly good!``` Creating a layout While Mermaid markdown diagrams aren’t supported natively by Hugo, it’s easy to add.\nAs the docs mention the first step is to create layouts/_default/_markup/render-codeblock-mermaid.html:\n{{- .Inner | safeHTML }} {{ .Page.Store.Set \"hasMermaid\" true }} Adding Mermaid to a content template The next step is less obvious, while the docs mention to add a code block to a content template it needs a bit of clarification.\nA content template template is what Hugo uses to render types of pages: list, single, summary.\nList: the list view of your posts Summary: the small section in visible before clicking into a post Single: the content of your post We’ll focus on the ‘single’ as this is where the diagrams will be rendered. So under layouts/_default/ you can create a single.html file to then add the code snippet to handle the Mermaid diagrams.\n{{ if .Page.Store.Get \"hasMermaid\" }} {{ end }} Maintaining content and theme styles Adding the code above on it’s own will make all your ‘single’ posts 404 as we haven’t told Hugo to render any content because omitted a .Content block. The reason for this is because of the render order Hugo has. As such, the default behaviour of the template was overridden and we removed the content and styles.\nHugo uses the following lookup order for content views:\n/layouts//.html /layouts/_default/.html /themes//layouts//.html /themes//layouts/_default/.html To update and maintain your changes, go to your theme provider’s layout folder copy the layout and then create a new file in your own layouts folder.\nI’m using the PaperMod theme and my version would be:\n/themes/PaperMod/layouts/single.html\nand then copy the entire file to:\n/layouts/_default/single.html\nNow, we’re able to override the PaperMod theme and subsequent updates won’t change our configuration.\n…But we’re still not seeing a Mermaid diagram. To do this, we need to find the .Content block and add the Mermaid script for Hugo to render diagrams.\nIn the ‘single’ file, find the .Content block and update it to use the Mermaid script from the Hugo docs. My layout Content block looks something like this:\n{{- if .Content }} {{- if not (.Param \"disableAnchoredHeadings\") }} {{- partial \"anchored_headings.html\" .Content -}} {{- else }}{{ .Content }}{{ end }} {{ if .Page.Store.Get \"hasMermaid\" }} {{ end }} Notice that the script is inside the if .Content block.\nRendering an example diagram If you now run hugo new posts/diagrams.md to create a new post, add the example Mermaid diagram at the top and execute hugo server -D (‘D’ to render drafts), it should now render.\nFYI, if you don’t have a posts directory, just switch it to wherever you keep your .md files.\nThe diagram:\nsequenceDiagram participant Alice participant Bob Alice-\u003e\u003eJohn: Hello John, how are you? loop Healthcheck John-\u003e\u003eJohn: Fight against hypochondria end Note right of John: Rational thoughts prevail! John--\u003e\u003eAlice: Great! John-\u003e\u003eBob: How about you? Bob--\u003e\u003eJohn: Jolly good! Links\nHugo docs: Mermaid diagrams Hugo docs: Content view templates ","wordCount":"609","inLanguage":"en","datePublished":"2024-02-06T08:35:09Z","dateModified":"2024-02-06T08:35:09Z","author":{"@type":"Person","name":"Clement Seconde-Kynnersley"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://clem-sk.dev/posts/using-mermaid-with-hugo/"},"publisher":{"@type":"Organization","name":"Clem SK","logo":{"@type":"ImageObject","url":"https://clem-sk.dev/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://clem-sk.dev/ accesskey=h title="Clem SK (Alt + H)">Clem SK</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://clem-sk.dev/aboutme/ title="Start Here"><span>Start Here</span></a></li><li><a href=https://clem-sk.dev/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://clem-sk.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://clem-sk.dev/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://clem-sk.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://clem-sk.dev/>Home</a>&nbsp;»&nbsp;<a href=https://clem-sk.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Using Mermaid With Hugo</h1><div class=post-meta><div class=post-meta><span title=2024-02-06T08:35:09Z>February 6, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;609 words&nbsp;·&nbsp;<strong><a href=/tags/diagrams/>#diagrams</a></strong>&nbsp;<strong><a href=/tags/mermaid/>#mermaid</a></strong></div></div></header><div class=post-content><h3 id=main-steps>Main steps<a hidden class=anchor aria-hidden=true href=#main-steps>#</a></h3><ul><li>Create a layout</li><li>Adding Mermaid to a content template</li><li>Maintaining content and theme styles</li><li>Rendering an example diagram</li></ul><h3 id=mermaid-diagram>Mermaid diagram<a hidden class=anchor aria-hidden=true href=#mermaid-diagram>#</a></h3><p>This post outlines how to add Mermaid support with Hugo to render the diagram below, as I found the docs a bit lacking.</p><blockquote><p>When pasting, make sure to move the closing code fence to a new line to see the diagram</p></blockquote><pre tabindex=0><code>```mermaid
sequenceDiagram
    participant Alice
    participant Bob
    Alice-&gt;&gt;John: Hello John, how are you?
    loop Healthcheck
        John-&gt;&gt;John: Fight against hypochondria
    end
    Note right of John: Rational thoughts &lt;br/&gt;prevail!
    John--&gt;&gt;Alice: Great!
    John-&gt;&gt;Bob: How about you?
    Bob--&gt;&gt;John: Jolly good!```
</code></pre><h3 id=creating-a-layout>Creating a layout<a hidden class=anchor aria-hidden=true href=#creating-a-layout>#</a></h3><p>While Mermaid markdown diagrams aren&rsquo;t supported natively by Hugo, it&rsquo;s easy to add.</p><p>As the docs mention the first step is to create <code>layouts/_default/_markup/render-codeblock-mermaid.html</code>:</p><pre tabindex=0><code>&lt;pre class=&#34;mermaid&#34;&gt;
  {{- .Inner | safeHTML }}
&lt;/pre&gt;
{{ .Page.Store.Set &#34;hasMermaid&#34; true }}
</code></pre><h3 id=adding-mermaid-to-a-content-template>Adding Mermaid to a content template<a hidden class=anchor aria-hidden=true href=#adding-mermaid-to-a-content-template>#</a></h3><p>The next step is less obvious, while the docs mention to add a code block to a content template it needs a bit of clarification.</p><p>A content template template is what Hugo uses to render types of pages: list, single, summary.</p><ul><li>List: the list view of your posts</li><li>Summary: the small section in visible before clicking into a post</li><li>Single: the content of your post</li></ul><p>We&rsquo;ll focus on the &lsquo;single&rsquo; as this is where the diagrams will be rendered. So under <code>layouts/_default/</code> you can create a <code>single.html</code> file to then add the code snippet to handle the Mermaid diagrams.</p><pre tabindex=0><code>{{ if .Page.Store.Get &#34;hasMermaid&#34; }}
  &lt;script type=&#34;module&#34;&gt;
    import mermaid from &#39;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs&#39;;
    mermaid.initialize({ startOnLoad: true });
  &lt;/script&gt;
{{ end }}
</code></pre><h3 id=maintaining-content-and-theme-styles>Maintaining content and theme styles<a hidden class=anchor aria-hidden=true href=#maintaining-content-and-theme-styles>#</a></h3><p>Adding the code above on it&rsquo;s own will make all your &lsquo;single&rsquo; posts 404 as we haven&rsquo;t told Hugo to render any content because omitted a <code>.Content</code> block. The reason for this is because of the <a href=https://gohugo.io/templates/views/#which-template-will-be-rendered>render order</a> Hugo has. As such, the default behaviour of the template was overridden and we removed the content and styles.</p><p>Hugo uses the following lookup order for content views:</p><ol><li><code>/layouts/&lt;TYPE>/&lt;VIEW>.html</code></li><li><code>/layouts/_default/&lt;VIEW>.html</code></li><li><code>/themes/&lt;THEME>/layouts/&lt;TYPE>/&lt;VIEW>.html</code></li><li><code>/themes/&lt;THEME>/layouts/_default/&lt;VIEW>.html</code></li></ol><p>To update and maintain your changes, go to your theme provider&rsquo;s layout folder copy the layout and then create a new file in your own layouts folder.</p><p>I&rsquo;m using the PaperMod theme and my version would be:</p><p><code>/themes/PaperMod/layouts/single.html</code></p><p>and then copy the entire file to:</p><p><code>/layouts/_default/single.html</code></p><p>Now, we&rsquo;re able to override the PaperMod theme and subsequent updates won&rsquo;t change our configuration.</p><p>&mldr;But we&rsquo;re still not seeing a Mermaid diagram. To do this, we need to find the <code>.Content</code> block and add the Mermaid script for Hugo to render diagrams.</p><p>In the &lsquo;single&rsquo; file, find the <code>.Content</code> block and update it to use the Mermaid script from the Hugo docs. My layout Content block looks something like this:</p><pre tabindex=0><code>{{- if .Content }}
    &lt;div class=&#34;post-content&#34;&gt;
        {{- if not (.Param &#34;disableAnchoredHeadings&#34;) }}
        {{- partial &#34;anchored_headings.html&#34; .Content -}}
        {{- else }}{{ .Content }}{{ end }}
    &lt;/div&gt;
    {{ if .Page.Store.Get &#34;hasMermaid&#34; }}
    &lt;script type=&#34;module&#34;&gt;
        import mermaid from &#39;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs&#39;;
        mermaid.initialize({ startOnLoad: true });
    &lt;/script&gt;
    {{ end }}
</code></pre><p>Notice that the script is inside the <code>if .Content</code> block.</p><h3 id=rendering-an-example-diagram>Rendering an example diagram<a hidden class=anchor aria-hidden=true href=#rendering-an-example-diagram>#</a></h3><p>If you now run <code>hugo new posts/diagrams.md</code> to create a new post, add the example Mermaid diagram at the top and execute <code>hugo server -D</code> (&lsquo;D&rsquo; to render drafts), it should now render.</p><p>FYI, if you don&rsquo;t have a <code>posts</code> directory, just switch it to wherever you keep your <code>.md</code> files.</p><p>The diagram:</p><pre class=mermaid>sequenceDiagram
    participant Alice
    participant Bob
    Alice->>John: Hello John, how are you?
    loop Healthcheck
        John->>John: Fight against hypochondria
    end
    Note right of John: Rational thoughts <br>prevail!
    John-->>Alice: Great!
    John->>Bob: How about you?
    Bob-->>John: Jolly good!
</pre><p>Links</p><ul><li><a href=https://gohugo.io/content-management/diagrams/#mermaid-diagrams>Hugo docs: Mermaid diagrams</a></li><li><a href=https://gohugo.io/templates/views/>Hugo docs: Content view templates</a></li></ul></div><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script><footer class=post-footer><nav class=paginav><a class=prev href=https://clem-sk.dev/posts/writing-process/><span class=title>« Prev</span><br><span>Writing Process</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://clem-sk.dev/>Clem SK</a></span>
<span><a href=https://creativecommons.org/licenses/by-nc-nd/4.0>CC BY-NC-ND</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>